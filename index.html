<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>My To Do List</title>
        <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
        <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>        
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
       <div id="todoWrapper"></div>

       <script type="text/babel">

            function Form(){        

                const {useState} = React;
                // Variables declaration
                const [lists, setList] = useState([]);
                const [inputTask, setTask] = useState("");
                console.log(lists);
                
                const displayTasks = (lists) =>{
                    if (localStorage.getItem("tasks") == null) return;
                    lists = JSON.parse(localStorage.getItem("tasks"));
                    setList(lists);                    
                }
                
                window.addEventListener('load', () => {
                    displayTasks(lists);
                })
               
                
                // Adding form data into the task list array
                const addTask = (todo) => {
                    const taskArray = {
                        id: Math.random(),
                        todo: todo,
                        completed: false
                    }; 

                    setList([...lists, taskArray]); // Appending new tasks to the list
                    localStorage.setItem("tasks", JSON.stringify([...JSON.parse(localStorage.getItem("tasks") || "[]"), 
                        {   id: Math.random(),
                            todo: todo,
                            completed: false
                        }
                    ]));
                    setTask("");
                }

                // Changing status of the completed tasks
                const completeTask = (i) => {
                    lists[i].completed = true;
                    let el = lists.map((item) => {
                        if(item.id === i){
                            item.completed=true
                        }
                        return item
                    });
    
                    setList(el);                    
                }
                
                // Delete a task
                const deleteTask = (i) => {
                    const newList = lists.filter((todo) => todo.id !== i);
                    setList(newList);
                }

                return (
                    <div onload={()=>displayTasks()}>
                        <h4>My To Do List</h4>
                        <div className="form-hold">                            
                            <input
                            type="text"
                            value={inputTask}
                            placeholder="Enter task.."
                            onChange={(e) => setTask(e.target.value)}
                            />
                            <button onClick={() => addTask(inputTask)}>Add</button>
                        </div>
                        <table>
                            {lists.map((todo, index) => (
                                    <tr>
                                        <td>{index+1}</td>
                                        <td className={(todo.completed)?'finished':''}>{todo.todo}</td>
                                        {
                                            (todo.completed)?<td>Completed</td>:<td>In progress</td>
                                        }
                                        <td><button onClick={() => completeTask(index)}>Complete</button></td>
                                        <td><button onClick = {() => deleteTask(todo.id)}>Delete</button></td>
                                    </tr>
                            ))}
                        </table>
                    </div>

                )

            }
            ReactDOM.render(<Form />, document.getElementById('todoWrapper'))
            
       </script>
    </body>
</html>